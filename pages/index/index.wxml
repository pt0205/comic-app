<!--index.wxml-->
<view class='container'>
    <!-- 模糊背景 -->
    <view class='home_bg'>
        <image src='{{banner.length && banner[0].showpicurlb || "/image/bg.jpg"}}'></image>
    </view>
    <!-- 搜索框 -->
    <view class='search_w' bindtap='gotoSearch'>
        <image src='/image/icon_search.png'></image>
        <text>漫画名 作者</text>
    </view>
    <!-- 分类列表 -->
    <view class='category_w'>
        <scroll-view scroll-x class='scroll_w' scroll-into-view="{{toCategory}}" scroll-with-animation="{{true}}">
            <view id='category_{{item.cid}}' class='item {{nowCid == item.cid && "active"}}' wx:for='{{categoryList}}' wx:key='{{item.cid}}' data-category='{{item}}' bindtap='slectCategory'>{{item.name}}</view>
        </scroll-view>
        <view wx:if='{{categoryList.length}}' class='fixed_menu' bindtap='toggleCategory'>
            <image src='/image/icon_menu.png'></image>
        </view>
    </view>
    <!-- 分类弹出框 -->
    <view wx:if="{{showCategoryDialog}}" class='category_dialog_w'>
        <view class='category_dialog_icon_close' bindtap='toggleCategory'>
            <image src='/image/icon_close.png'></image>
        </view>
        <view class='category_dialog_list_w'>
            <block wx:for='{{categoryList}}' wx:key='{{item.cid}}'>
                <view class='item' data-category='{{item}}' bindtap='slectCategory'>{{item.name}}</view>
            </block>
        </view>
    </view>
    <swiper class='list_swiper_w' bindanimationfinish='animationFinish' current='{{nowCidIndex}}' duration='{{500}}' circular='{{false}}'>
        <swiper-item class='swiper_item' wx:for='{{categoryList}}' wx:for-item='cItem' wx:key='{{cItem.cid}}'>
            <scroll-view wx:if='{{(renderCids[0]===cItem.cid || renderCids[1]===cItem.cid || renderCids[2]===cItem.cid) && cItem.cid===0}}' class="recommend_comic_scroll" data-cid='{{0}}' bindscroll='onScroll' scroll-top='{{scrollTop[cItem.cid]}}' scroll-y>
                <!-- 轮播图 -->
                <swiper class='banner_w' circular='{{true}}' autoplay='{{true}}' interval='{{5000}}' duration="{{500}}" bindchange="bannerChang">
                    <swiper-item wx:for="{{banner}}" wx:for-item='homeItem'  wx:key='{{homeItem.comicid}}'>
                        <view class='banner_item' style='background:url({{homeItem.showconver}}) no-repeat center;background-size:cover' data-comic='{{homeItem}}' bindtap='gotoDetail'>
                            <view class='banner_bottom'>
                                <view>{{homeItem.title}}</view>
                                <view>
                                    <text class='banner_now'>{{currentBannerIndex+1}}</text>
                                    <text>/{{banner.length}}</text>
                                </view>
                            </view>
                        </view>
                    </swiper-item>
                </swiper>
                <!-- 各分类推荐列表 -->
                <block wx:if='{{homeCItem.category.cid}}' wx:for="{{recommend}}" wx:for-item="homeCItem" wx:key='{{homeCItem.cid}}'>
                    <view class='category_title_w'>
                        <view class='left_w'>
                            <view class='vertical_line'></view>
                            <text class='category_title'>{{homeCItem.category.name}}</text>
                        </view>
                        <button class='read_more' plain='{{true}}' data-category='{{homeCItem.category}}' bindtap='slectCategory'></button>
                    </view>
                    <view class='hot_item_w'>
                        <scroll-view class='hot_scroll' scroll-x>
                            <view class='hot_item' wx:for="{{homeCItem.list}}" wx:for-item='homeClistItem' wx:key='{{homeClistItem.comicid}}' data-comic='{{homeClistItem}}' bindtap='gotoDetail'>
                                <view class='hot_img'>
                                    <image src='{{homeClistItem.showpicurlb}}' lazy-load='{{true}}' mode='aspectFill' style='width:100%;height:100%'></image>
                                </view>
                                <view class='hot_title'>{{homeClistItem.title}}</view>
                                <view class='hot_time'>{{homeClistItem.lastupdatetime}}</view>
                            </view>
                        </scroll-view>
                        <view class='hot_bottom_line'></view>
                    </view>
                </block>
            </scroll-view>
            <!-- 各分类下的列表 -->
            <block wx:if='{{(renderCids[0]===cItem.cid || renderCids[1]===cItem.cid || renderCids[2]===cItem.cid) && cItem.cid}}' wx:for='{{swiperDataMap[cItem.cid].viewArr}}' wx:for-item='vItem' wx:key='{{vItem}}'>
                <scroll-view wx:if='{{vItem==swiperDataMap[cItem.cid].nowView}}' class='category_comic_scroll' scroll-y bindscrolltolower='onLoadMore' lower-threshold='3000px' data-cid='{{cItem.cid}}' bindscroll='onScroll' scroll-top='{{scrollTop[cItem.cid]}}'>
                    <block wx:for='{{swiperDataMap[cItem.cid].renderData}}' wx:for-item='rItem' wx:for-index='rIndex' wx:key='{{rIndex}}'>
                        <view wx:if='{{rIndex >= vItem*viewSize && rIndex < (vItem+1)*viewSize+overlappingPage}}' class='category_item' wx:for='{{rItem}}' wx:key='{{comicItem.comicid}}' wx:for-item='comicItem' data-comic='{{comicItem}}' bindtap='gotoDetail'>
                            <view class='category_item_img'>
                                <image src='{{comicItem.showpicurlb}}' lazy-load='{{true}}' mode='aspectFill' style='width:100%;height:100%'></image>
                            </view>
                            <view class='category_item_title'>{{comicItem.title}}</view>
                            <view class='category_item_bottom_w'>
                                <view class='category_item_new'>{{comicItem.showlastpartname}}</view>
                                <view class='category_item_time'>{{comicItem.lastupdatetime}}</view>
                            </view>
                        </view>
                    </block>
                    <view wx:if='{{swiperDataMap[cItem.cid].totalPage <= swiperDataMap[cItem.cid].endPage}}' class='loading_tip'>
                        <image mode='widthFix' src="/image/icon_end.png"></image>
                        <text>没有更多了~</text>
                    </view>
                    <view wx:else class='loading_tip'>
                        <text>正在加载中...</text>
                    </view>
                </scroll-view>
            </block>
            <view wx:if='{{renderCids[0]!=cItem.cid && renderCids[1]!=cItem.cid && renderCids[2]!=cItem.cid}}' class='loading_tip'>
                <text>正在加载中...</text>
            </view>
        </swiper-item>
    </swiper>
</view>