<!--index.wxml-->
<view class='container'>
    <navigationBar wx:if='{{!showCategoryDialog}}' title='分类'></navigationBar>
    <!-- 模糊背景 -->
    <view class='blur_bg'>
        <image src='{{"/image/bg.jpg"}}'></image>
    </view>
    <!-- 分类列表 -->
    <view class='category_w'>
        <scroll-view scroll-x class='scroll_w' scroll-into-view="{{toCategory}}" scroll-with-animation="{{true}}">
            <view id='category_{{item.cid}}' class='item {{nowCid == item.cid ? "active" : ""}}' wx:for='{{categoryList}}' wx:key='{{item.cid}}' data-category='{{item}}' bindtap='slectCategory'>{{item.name}}</view>
        </scroll-view>
        <view wx:if='{{categoryList.length}}' class='fixed_menu' bindtap='toggleCategory'>
            <image src='/image/icon_menu.png'></image>
        </view>
        <view class='category_line'></view>
    </view>
    <!-- 分类弹出框 -->
    <view wx:if="{{showCategoryDialog}}" class='category_dialog_w' style='padding-top:{{navHeight+statusBarHeight}}px;'>
        <view class='category_dialog_icon_close' bindtap='toggleCategory' style='margin-top:{{navHeight+statusBarHeight}}px;'>
            <image src='/image/icon_close.png'></image>
        </view>
        <view class='category_dialog_list_w'>
            <block wx:for='{{categoryList}}' wx:key='{{item.cid}}'>
                <view class='item' data-category='{{item}}' bindtap='slectCategory'>{{item.name}}</view>
            </block>
        </view>
    </view>
    <swiper class='list_swiper_w' style='margin-top:{{navHeight+statusBarHeight}}px;' bindanimationfinish='animationFinish' bindchange='swiperChange' current='{{nowCidIndex}}' duration='{{animationDuration}}' circular='{{false}}'>
        <swiper-item class='swiper_item' wx:for='{{categoryList}}' wx:for-item='cItem' wx:key='{{cItem.cid}}'>
            <view class='order_w {{swiperDataMap[cItem.cid] && swiperDataMap[cItem.cid].showSort ? "active" : ""}}'>
                <view class='order_item {{swiperDataMap[cItem.cid].sort=="read_count" ? "active" : ""}}' data-sort='read_count' data-cid='{{cItem.cid}}' bindtap='selectSort'>热门</view>
                <view class='order_item {{swiperDataMap[cItem.cid].sort=="update_time" && swiperDataMap[cItem.cid].status!=1 ? "active" : ""}}' data-sort='update_time' data-cid='{{cItem.cid}}' bindtap='selectSort'>更新</view>
                <view class='order_item {{swiperDataMap[cItem.cid].sort=="publish_time" ? "active" : ""}}' data-sort='publish_time' data-cid='{{cItem.cid}}' bindtap='selectSort'>新上架</view>
                <view class='order_item {{swiperDataMap[cItem.cid].status==1 ? "active" : ""}}' data-status='{{1}}' data-cid='{{cItem.cid}}' bindtap='selectSort'>完成</view>
            </view>
            <!-- 各分类下的列表 -->
            <block wx:if='{{(renderCids[0]===cItem.cid || renderCids[1]===cItem.cid || renderCids[2]===cItem.cid)}}' wx:for='{{swiperDataMap[cItem.cid].viewArr}}' wx:for-item='vItem' wx:key='{{vItem}}'>
                <scroll-view wx:if='{{vItem==swiperDataMap[cItem.cid].nowView}}' class='category_comic_scroll' scroll-y bindscrolltolower='onLoadMore' lower-threshold='3000px' data-cid='{{cItem.cid}}' bindscroll='onScroll' scroll-top='{{scrollTop[cItem.cid]}}'>
                    <view class='scroll_list_w'>
                        <block wx:for='{{swiperDataMap[cItem.cid].renderData}}' wx:for-item='rItem' wx:for-index='rIndex' wx:key='{{rIndex}}'>
                            <view wx:if='{{rIndex >= vItem*viewSize && rIndex < (vItem+1)*viewSize+overlappingPage}}' class='comic_item' wx:for='{{rItem}}' wx:key='{{comicItem.comicid}}' wx:for-item='comicItem' data-comic='{{comicItem}}' bindtap='gotoDetail'>
                                <view class='comic_item_img'>
                                    <image src='{{comicItem.showpicurlb}}' lazy-load='{{true}}' mode='aspectFill' style='width:100%;height:100%'></image>
                                </view>
                                <view class='comic_item_title'>{{comicItem.title}}</view>
                                <view class='comic_item_bottom_w'>
                                    <view class='comic_item_new'>{{comicItem.last_part_name}}</view>
                                    <view class='comic_item_time'>{{comicItem.lastupdatetime}}</view>
                                </view>
                            </view>
                        </block>
                    </view>
                    <view wx:if='{{swiperDataMap[cItem.cid].totalPage <= swiperDataMap[cItem.cid].endPage}}' class='loading_tip'>
                        <image mode='widthFix' src="/image/icon_end.png"></image>
                        <text>没有更多了~</text>
                    </view>
                    <view wx:else class='loading_tip'>
                        <text>正在加载中...</text>
                    </view>
                </scroll-view>
            </block>
        </swiper-item>
    </swiper>
    <cover-view wx:if='{{stopSwiper}}' class='list_swiper_cover'></cover-view>
</view>